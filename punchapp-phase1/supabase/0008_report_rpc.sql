create or replace function public.report_sum_minutes_paid(p_start date, p_end date) returns table ( user_id uuid, name text, email text, employee_code text, minutes_paid integer ) language sql stable as $$ select p.id as user_id, p.name, p.email, p.employee_code, coalesce(sum(d.minutes_paid),0) as minutes_paid from profiles p left join daily_totals d on d.user_id = p.id and d.date between p_start and p_end where p.role <> 'pending' group by p.id, p.name, p.email, p.employee_code order by p.name nulls last $$;
