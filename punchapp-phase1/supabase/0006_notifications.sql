create table if not exists public.notifications (id uuid primary key default gen_random_uuid(),user_id uuid references auth.users(id) on delete cascade,channel text check (channel in ('email','push','system')) not null,title text not null,body text not null,link text,sent_at timestamptz,error text,created_at timestamptz default now());
create or replace function public.enqueue_notification(p_user uuid, p_channel text, p_title text, p_body text, p_link text default null) returns void language plpgsql as $$ begin insert into notifications(user_id,channel,title,body,link) values(p_user,p_channel,p_title,p_body,p_link); end; $$;
