const DB='punchapp-idb',STORE='queue';export function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB,1);r.onupgradeneeded=()=>{const db=r.result;if(!db.objectStoreNames.contains(STORE)){const os=db.createObjectStore(STORE,{keyPath:'id'});os.createIndex('t','t')}};r.onsuccess=()=>res(r.result);r.onerror=()=>rej(r.error)})}
export async function put(op){const db=await openDB();const tx=db.transaction(STORE,'readwrite');tx.objectStore(STORE).put(op);return new Promise((res,rej)=>{tx.oncomplete=()=>res();tx.onerror=()=>rej(tx.error)})}
export async function all(){const db=await openDB();const tx=db.transaction(STORE,'readonly');const os=tx.objectStore(STORE);return new Promise((res,rej)=>{const r=os.getAll();r.onsuccess=()=>res(r.result||[]);r.onerror=()=>rej(r.error)})}
export async function del(id){const db=await openDB();const tx=db.transaction(STORE,'readwrite');tx.objectStore(STORE).delete(id);return new Promise((res,rej)=>{tx.oncomplete=()=>res();tx.onerror=()=>rej(tx.error)})}
