self.addEventListener('install',e=>{self.skipWaiting()}); self.addEventListener('activate',e=>{self.clients.claim()}); self.addEventListener('push',e=>{ if(!e.data) return; const d=e.data.json(); e.waitUntil(self.registration.showNotification(d.title||'PunchApp',{body:d.body,icon:'/icons/icon-192.png',data:d.link||'/'})) }); self.addEventListener('notificationclick',e=>{ e.notification.close(); const url=e.notification.data; e.waitUntil(clients.openWindow(url)) }); self.addEventListener('sync',async e=>{ if(e.tag==='queue-flush'){ e.waitUntil(flushQueue()) } }); async function flushQueue(){ const all=await self.clients.matchAll({includeUncontrolled:true}); for(const c of all){ c.postMessage({type:'FLUSH_QUEUE'}) } }
